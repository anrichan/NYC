<div class="article_index_contents">
  <div class="article_index_box">
    <div class="article_index_map">
      <div style='width: 800px;'>
        <div id="map" style='width: 800px; height: 400px;'></div>
      </div>
    </div>
    <% @articles.each do |article| %>
      <ul>
      <li><span><%= link_to article.title, article_path(article.id) %></span></li>
      <span><%= article.created_at.to_s(:day) %></span>
      <% stars = article.reviews.average(:rate).to_i %>
      <span class="stars"><% stars.times do %>
        <a href=""><img src="/assets/images/rate/small_star.png"/></a>
        </span>
      <% end %>
      <%= article.reviews.average(:rate) %>点
     
      <td>
      <% if article.favorited_by? current_user %>
        <%= link_to article_favorites_path(article), method: :delete do %>
        <img src="/assets/images/rate/love_mini_pp.png"/>
        <% end %>
      <% else %>
        <%= link_to article_favorites_path(article), method: :post do %>
        <img src="/assets/images/rate/love_mini_ww.png"/>
        <% end %>
       </ul>
      </td>
      <% end %>
      <%#= link_to "消す", article_path(article.id), method: :delete %>
    <% end %>
    <!-- ランクのやつ -->
    <%# @rank.each do |rank| %>
      <%#= rank.title %>
      <%#= rank.reviews.average(:rate) %>
    <%# end %>
    <!-- マップ -->
      <script>
      function initMap() {
        var center = {lat: <%= @articles.last.latitude %>, lng: <%= @articles.last.longitude %>};
        var map = new google.maps.Map(document.getElementById('map'), {
                zoom: 4,
                center: center
                });
        
        var marker = new google.maps.Marker({
                position: center,
                map: map
               
                });
        // マーカー
        <% @articles.each do |article| %>
          
          var address<%= article.id %> = {lat: <%= article.latitude %>, lng: <%= article.longitude %>};
          var marker<%= article.id %> = new google.maps.Marker({
                position: address<%= article.id %>,
                map: map,
                title: contentString<%= article.id %>
                });
          var contentString<%= article.id %> = '▶︎：<%= link_to article.title, article_path(article.id) %>';
          var infowindow<%= article.id %> = new google.maps.InfoWindow({
                content: contentString<%= article.id %>
                });
          marker<%= article.id %>.addListener('click', function() {
              infowindow<%= article.id %>.open(map, marker<%= article.id %>);
            });
            <% end %>
         };
      </script>
      <div class="article_index_newlink">
        <span><%= link_to new_article_path do %>
          <button type="button" class="btn btn-default">new</button>
        </span>
        <% end %>
      </div>
      <div class="article_index_maypagelink">
        <span><%= link_to  "/users/#{current_user.id}" do %>
          <button type="button" class="btn btn-default">My page</button>
        </span>
        <% end %>
      </div>
  </div>
  </div>
